'use strict';const nodemailer = require('nodemailer');const fs = require('fs');const request = require('request');module.exports = function (app) {    function sendMessage(event) {        let sender = event.sender.id;        let text = event.message.text;        request({            url: 'https://graph.facebook.com/v2.6/me/messages',            qs: {access_token: 'EAAHUnsMJhXMBAPZB9OdQ3iOIAg3E2UvhQzMHiZBhUH4ieByYIslgrOwqokiQBIVBFfNZB5CZACGzu7m2XE0CZAaJyWqgJjKQatyWFzpkEGM10W4ipij1AXh2FBfQlRoTEsIO3p0KZCa7vJXjlW92kUdsHZBy3dnZBId6jZAAIrznNC3ROs3vL19MS'},            method: 'POST',            json: {                recipient: {id: sender},                message: {text: text}            }        }, function (error, response) {            if (error) {                console.log('Error sending message: ', error);            } else if (response.body.error) {                console.log('Error: ', response.body.error);            }        });    }    // Note that res.sendFile() is not implemented with the sendfile system call, which     // would make it far more efficient. Instead, use serve-static middleware (or something     // equivalent), that is optimized for serving files for Express apps. An even better option     // is to use a reverse proxy to serve static files; see Use a reverse proxy for more information    app.get('/', function(req,res) {        res.sendFile(require('path').join(__dirname, '../views/index.html'));    });    // Facebook Webhook   // Used for verification    app.get("/webhook", function (req, res) {        if (req.query["hub.verify_token"] === "this_is_my_token") {          console.log("Verified webhook");          res.status(200).send(req.query["hub.challenge"]);        } else {          console.error("Verification failed. The tokens do not match.");          res.sendStatus(403);        }    });    /* Handling all messenges */    app.post('/webhook', (req, res) => {          console.log(req.body);          if (req.body.object === 'page') {                req.body.entry.forEach((entry) => {                      entry.messaging.forEach((event) => {                            if (event.message && event.message.text) {                              sendMessage(event);                            }                      });                });                res.status(200).end();          }    });    app.get('/robots.txt', function(req,res) {        res.sendFile(require('path').join(__dirname, '../robots.txt'));    });    app.post('/api/sendemail', function(req,res) {		    		let transporter = nodemailer.createTransport({  		    host: 'smtp.gmail.com',  		    port: 465,  		    secure: true, // secure:true for port 465, secure:false for port 587  		    auth: {  		        user: 'teamplatoworks@gmail.com',  		        pass: 'myway$1A'  		    },          tls: {              // do not fail on invalid certs              rejectUnauthorized: false          }  		});       		let mailOptions = {  		    from: `"${req.body.name} ðŸ‘»" <${req.body.email}>`, // sender address  		    to: 'raopreetam007@gmail.com', // list of receivers  		    subject: `PLATOWORKS INQUIRY FROM ${req.body.email}`, // Subject line          html : `<b>${req.body.email}</b><br>${req.body.message}`  		};  		// send mail with defined transport object  		transporter.sendMail(mailOptions, (error, info) => {  		    if (error) {  		        return res.status(404).send("Oh uh, something went wrong");  		    }  		    console.log('Message %s sent: %s', info.messageId, info.response);          res.json("success");  		});    });    app.get('*',function(req,res) {      res.redirect('/');    });};